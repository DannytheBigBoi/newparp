<!DOCTYPE html>
{% macro pager(): %}
{% if paginator.page_count!=1 %}
<p class="pager">
{{paginator.pager(format="~20~")|safe}}
</p>
{% endif %}
{% endmacro %}
{% macro render_messages(messages, show_timestamps=True): %}
    {% set last_date = None %}
    {% for message in messages: %}
    {% if show_timestamps: %}
    {% set current_date = (g.user.localize_time(message.posted) if g.user else message.posted).date() %}
    {% if current_date != last_date %}
	<h2>{{current_date.strftime("%A %d %B %Y")}}</h2>
    {% set last_date = current_date %}
    {% endif %}
    {% endif %}
<div id="message_{{message.id}}" class="message_{{message.type}}{% if message.chat_user != None: %} unum_{{message.chat_user.number}}{% if chat_user and message.chat_user.number in chat_user.highlighted_numbers: %} highlighted{% endif %}{% if chat_user and message.chat_user.number in chat_user.ignored_numbers: %} ignored{% endif %}{% endif %}">
    <div class="unum {% if message.chat_user != None: %}cnum_{{message.chat_user.number}}{% else %}cnum_noclick{% endif %}" tabindex="-1"> {% if message.chat_user != None %}<span class="unum_hash">#</span>{{message.chat_user.number}}{% else: %}<span class=\"unum_system\">*</span>{% endif %}</div>
    <p style="color: #{{message.color}};">{% if message.type == "me": %}* {{message.name}} {{message.text}}{% elif chat_user and chat.type == "roulette" and message.type in ("ic", "ooc"): %}{{"▲" if chat_user.number == message.chat_user.number else "▼"}}: {{message.text}}{% else: %}{% if message.acronym != "" %}{{message.acronym}}: {% endif %}{{message.text}}{% endif %} {% if show_timestamps: %}<time class="timestamp" datetime="{{message.posted.isoformat()}}">{{(g.user.localize_time(message.posted) if g.user else message.posted).strftime("%H:%M:%S")}}</time>{% endif %}</p>
</div>
    {% endfor %}
{% endmacro %}
<html>
<head>
<title>{% if chat.title: %}{{chat.title}}{% else: %}Chat{% endif %} - MSPARP</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="theme-color" content="#626262">
<link rel="icon" sizes="32x32" href="/static/img/icon-32.png">
<link rel="icon" sizes="192x192" href="/static/img/icon-hires.png">
<link rel="icon" sizes="16x16" href="/static/img/icon-16.png">
<link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=VT323' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/static/css/normalize.css">
<link rel="stylesheet" href="/static/css/newparp.css">
{% if g.user and g.user.theme: %}
<link id="theme_stylesheet" rel="stylesheet" href="/static/css/themes/{{g.user.theme}}.css">
{% endif %}
</head>
<body class="chat">
<script> // Enable form element fallback, avoid flashing
basic_forms=localStorage.getItem("basic_forms");
if (basic_forms == "true") {
document.body.className += ' no_forms';
}
</script>

<div id="global_announcements"></div>

{% block content: %}{% endblock %}

<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//cdn.jsdelivr.net/handlebarsjs/2.0.0/handlebars.min.js"></script>
<script src="/static/js/ui.js"></script>
<script src="/static/js/newparp.js"></script>
{% block scripts: %}{% endblock %}

{% if g.user and g.user.timezone == None: %}
<script src="/static/js/jstz-1.0.4.min.js"></script>
<script>
var timezone = jstz.determine().name();
if (timezone) {
	$.post("/settings/timezone", {"timezone": timezone, "token": {{g.csrf_token|tojson|safe}}});
}
</script>
{% endif %}

</body>
</html>
